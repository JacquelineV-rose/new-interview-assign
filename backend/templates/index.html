<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Material Table</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
  <h1>Material Query</h1>

  <input type="text" id="searchInput" placeholder="Search by formula or ID" />
  <button onclick="performSearch()">Search</button>
  <button onclick="resetTable()">Reset</button>

  <table id="materials-table">
    <thead>
      <tr>
        <th>Material ID</th>
        <th>Formula</th>
        <th>Energy Above Hull</th>
        <th>Band Gap</th>
        <th>Formation Energy</th>
        <th>Magnetization</th>
        <th>Space Group</th>
        <th>Stable</th>
        <th>Magnetic</th>
        <th>Ordering</th>
        <th>Experimental</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allMaterials = [];







    fetch('/api/materials')
      .then(res => res.json())
      .then(data => {
        allMaterials = data;
        display(allMaterials);
      });





    function display(materials) {
      const tbody = document.querySelector('#materials-table tbody');
      tbody.innerHTML = '';



      if (materials.length === 0) {
        tbody.innerHTML = '<tr><td colspan="11">No results found</td></tr>';
        return;
      }




      materials.forEach(m => {
        const tr = document.createElement('tr');

        const stable = m.energy_above_hull < 0.05 ? 'Yes' : 'No';
        const magnetic = m.total_magnetization > 0 ? 'Yes' : 'No';
        const ordering = m.magnetic_ordering ? m.magnetic_ordering : '-';
        const experimental = m.experimental_observed ? 'Yes' : 'No';




        tr.innerHTML = `
          <td><a href="/material/${m.material_id}">${m.material_id}</a></td>
          <td>${m.pretty_formula}</td>
          <td>${m.energy_above_hull}</td>
          <td>${m.band_gap}</td>
          <td>${m.formation_energy_per_atom}</td>
          <td>${m.total_magnetization}</td>
          <td>${m.space_group}</td>
          <td>${stable}</td>
          <td>${magnetic}</td>
          <td>${ordering}</td>
          <td>${experimental}</td>
        `;




        tbody.appendChild(tr);
      });
    }




    function performSearch() {
      const query = document.getElementById('searchInput').value.toLowerCase();



      
      if (!query) {
        display(allMaterials);
        return;
      }



      const filtered = allMaterials.filter(m => (m.pretty_formula && m.pretty_formula.toLowerCase().includes(query)) || (m.material_id && m.material_id.toLowerCase().includes(query)) || (m.magnetic_ordering && m.magnetic_ordering.toLowerCase().includes(query)));

      display(filtered);
    }




    function resetTable() {
      document.getElementById('searchInput').value = '';
      display(allMaterials);
    }
  </script>
</body>
</html>
