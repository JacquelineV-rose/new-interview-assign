<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Material Details</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <h1>Material Details</h1>
  <div id="details"></div>
  <button id="downloadBtn">Download JSON</button>
  <br><br>
  <a href="/">‚Üê Back to Table</a>

  <script>
    // Get the material ID from the URL
    const materialId = window.location.pathname.split('/').pop();

    // Load materials and find the one we want
    fetch('/api/materials')
      .then(res => res.json())
      .then(data => {
        const mat = data.find(m => m.material_id === materialId);

        if (!mat) {
          document.getElementById('details').innerText = 'Material not found';
          return;
        }

        const detailsDiv = document.getElementById('details');
        const table = document.createElement('table');

        for (let key in mat) {
          const row = document.createElement('tr');
          const val = mat[key] !== null ? mat[key] : '-';
          row.innerHTML = `<td><b>${key}</b></td><td>${val}</td>`;
          table.appendChild(row);
        }

        detailsDiv.appendChild(table);

        // Download button logic
        document.getElementById('downloadBtn').onclick = () => {
          const blob = new Blob([JSON.stringify(mat, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${mat.material_id}.json`;
          a.click();
          URL.revokeObjectURL(url);
        };
      });
  </script>
</body>
</html>
